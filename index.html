<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fill & Download Worksheet</title>

<style>
body {
  background: #f2bcbc;
  font-family: "Arial Rounded MT Bold", Arial, sans-serif;
  display: flex;
  justify-content: center;
  padding: 20px;
}

#worksheet {
  position: relative;
  width: 1100px;
}

canvas {
  width: 1100px;
  height: 700px;
  border: 6px solid #000;
  background: #fde7e4;
}

.ws-input {
  position: absolute;
  background: #fde7e4;
  border: 2px solid #000;
  font-size: 16px;
  padding: 6px;
  box-sizing: border-box;
}

.center {
  text-align: center;
}

.controls {
  text-align: center;
  margin-top: 15px;
}

button {
  font-size: 16px;
  padding: 10px 20px;
  cursor: pointer;
}
</style>
</head>

<body>

<div>
  <div id="worksheet">
    <canvas id="canvas" width="1100" height="700"></canvas>

    <!-- Header Inputs -->
    <input class="ws-input" id="name" style="top:22px; left:110px; width:300px;">
    <input class="ws-input" id="date" style="top:22px; left:780px; width:200px;">

    <!-- Title -->
    <input class="ws-input center" id="title"
      style="top:95px; left:350px; width:400px; font-size:22px;">

    <!-- Top labels -->
    <input class="ws-input center" id="b1" style="top:405px; left:100px; width:220px;">
    <input class="ws-input center" id="b2" style="top:405px; left:440px; width:220px;">
    <input class="ws-input center" id="b3" style="top:405px; left:780px; width:220px;">

    <!-- Bottom labels -->
    <input class="ws-input center" id="b4" style="top:595px; left:100px; width:220px;">
    <input class="ws-input center" id="b5" style="top:595px; left:440px; width:220px;">
    <input class="ws-input center" id="b6" style="top:595px; left:780px; width:220px;">
  </div>

  <div class="controls">
    <button onclick="download()">â¬‡ Download Worksheet</button>
  </div>
</div>

<script>
    
    const nameInput  = document.getElementById("name");
const dateInput  = document.getElementById("date");
const titleInput = document.getElementById("title");
const labelInputs = [
  document.getElementById("b1"),
  document.getElementById("b2"),
  document.getElementById("b3"),
  document.getElementById("b4"),
  document.getElementById("b5"),
  document.getElementById("b6"),
];

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

/* -------- IMAGES CONFIG -------- */
const tools = [
  { src: "images/axe.png", x: 110, y: 270 },
  { src: "images/wheelbarrow.png", x: 450, y: 270 },
  { src: "images/stairs.png", x: 790, y: 270 },
  { src: "images/ferriswheel.png", x: 110, y: 460 },
  { src: "images/hammer.png", x: 450, y: 460 },
  { src: "images/drill.png", x: 790, y: 460 }
];

const imageCache = {};

/* -------- PRELOAD IMAGES -------- */
function preloadImages(callback) {
  let loaded = 0;

  tools.forEach(t => {
    const img = new Image();
    img.src = t.src;
    img.onload = () => {
      imageCache[t.src] = img;
      loaded++;
      if (loaded === tools.length) callback();
    };
  });
}

/* -------- DRAW BASE CANVAS -------- */
function drawBase() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ðŸ”¥ FULL BACKGROUND (THIS FIXES BLACK JPG)
  ctx.fillStyle = "#fde7e4";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  /* Header */
  ctx.fillStyle = "#f2bcbc";
  ctx.fillRect(0, 0, 1100, 80);
  ctx.strokeStyle = "#000";
  ctx.lineWidth = 2;
  ctx.strokeRect(0, 0, 1100, 80);

  ctx.fillStyle = "#000";
  ctx.font = "18px Arial";
  ctx.fillText("Name:", 40, 48);
  ctx.fillText("Date:", 710, 48);

  /* Title Box */
  ctx.fillStyle = "#fde7e4";
  ctx.fillRect(330, 85, 440, 65);
  ctx.strokeRect(330, 85, 440, 65);
  ctx.font = "28px Arial";
  ctx.fillText("Add Title Here", 430, 128);

  /* Image Boxes + Images */
  tools.forEach(t => {
    ctx.setLineDash([8, 6]);
    ctx.strokeStyle = "#cc0000";
    ctx.lineWidth = 3;
    ctx.strokeRect(t.x - 20, t.y - 20, 260, 140);
    ctx.setLineDash([]);

    ctx.drawImage(imageCache[t.src], t.x, t.y, 220, 100);
  });
}

function drawInputText() {
  ctx.fillStyle = "#000";

  ctx.font = "18px Arial";
  ctx.fillText(nameInput.value || "", 120, 50);
  ctx.fillText(dateInput.value || "", 790, 50);

  ctx.font = "26px Arial";
  ctx.fillText(titleInput.value || "", 390, 128);

  labelInputs.forEach((el, i) => {
    const x = [110, 450, 790][i % 3] + 20;
    const y = i < 3 ? 425 : 615;
    ctx.font = "18px Arial";
    ctx.fillText(el.value || "", x, y);
  });
}

/* -------- DOWNLOAD -------- */
function download() {
  // Hide inputs
  document.querySelectorAll(".ws-input")
    .forEach(i => i.style.display = "none");

  drawBase();
  drawInputText();

  const link = document.createElement("a");
  link.download = "worksheet.jpg";
  link.href = canvas.toDataURL("image/jpeg", 0.95);
  link.click();

  // Restore inputs
  document.querySelectorAll(".ws-input")
    .forEach(i => i.style.display = "block");
}


/* -------- INIT -------- */
preloadImages(() => {
  drawBase();
});
</script>

</body>
</html>
